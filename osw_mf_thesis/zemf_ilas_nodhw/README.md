# DESCRIPTION
The case is the full model without *any* domestic hot water systems. The absence of *any* dhw system has the benefit that air and plant loops can be removed in the EnableIdealAirLoads measure without invalidating the IDF run.

# NOTES
I do not recommend using the OpenStudio app (packaged with OS-3.0.1) for Ideal Air Loads. Previously, I have used the app to enable Ideal Loads and turn on the Output Variable described below.

# CLUSTER VARIABLES
The variable chosen for clustering is the idealized cooling load (sensible and latent) from the ZoneHVAC:IdealLoadsAirSystem objects, `Zone Ideal Loads Zone Total Cooling Energy`.

### Ideal Air Loads
The simplest piece of zone equipment is the ZoneHVAC:IdealLoadsAirSystem component. ZoneHVAC:IdealLoadsAirSystem is used in situations where the user wishes to study the performance of a building without modeling a full HVAC system. In such a case, the Ideal Loads Air System is usually the sole conditioning component: the user does not need to specify air loops, water loops, etc. All that is needed for the ideal system are zone controls, zone equipment configurations, and the ideal loads system component.

This component can be operated with infinite or finite heating and cooling capacity. For either mode – infinite or limited capacity – the user can also specify on/off schedules for heating and cooling and outdoor air controls. There are also optional controls for dehumidification, humidification, economizer, and heat recovery. This component may be used in combination with other HVAC equipment serving the same zone.

This component can be thought of as an ideal unit that mixes air at the zone exhaust condition with the specified amount of outdoor air and then adds or removes heat and moisture at 100% efficiency in order to produce a supply air stream at the specified conditions. The energy required to condition the supply air is metered and reported as DistrictHeating and DistrictCooling.

Notes: The ideal loads system uses the zone return node or an optional zone exhaust node to extract air from the zone. Every zone served by an HVAC component must have a return air node, even though this node may not be connected to anything.

# BREAK

## Gas Water Heaters as a Stand-in
After extensive testing, my knowledge of the OpenStudio SDK is not enough to solve the problem of using Ideal Air Loads in models with HPWHs. Instead I have opted for a gas heater tank to complete my comparison table for my thesis. This way, the latent and sensible zone gains of DHW use are reflected in my sizing calculations.

## Notes
I do not recommend using the OpenStudio visual application to do ideal air loads.

## Cluster Variables
The variable chosen for clustering is the idealized cooling load (sensible and latent) from the ZoneHVAC:IdealLoadsAirSystem objects, Zone Ideal Loads Zone Total Cooling Energy.

## Standards Bug
Currently, only ASHRAE90.1-2013 is supported in Standard.build('90.1-2013') for gas-fired water heaters in the CLI embedded standards library.

Trying to use `'ZE AEDG Multifamily'` as the standard build in the vanilla CLI throws an error. The openstudio-standards library tries to invoke the method `#model_apply_hvac_efficiency_standard` whose definition has a line:

`model.getWaterHeaterMixeds.sort.each { |obj| water_heater_mixed_apply_efficiency_and_curves(obj) }`. The WaterHeater:Mixed objects here include those used with natural gas fuel--and electricy fuel.

There is likely a difference in JSON data between standards `90.1-2013` and `ZE AEDG Multifamily` and this is causing a error to be thrown. String can't be coerced into Float for the ruby line `ef = base_ef - (vol_drt * volume_gal)` in `standards/Standards.WaterHeaterMixed.rb`. This comes from the `wh_props` array that is generated by the method call `model_find_object(standards_data['water_heaters'], search_criteria, capacity_btu_per_hr)`

The answer lies in the file `standards/ashrae_90_1/*/data/ze_aedg_multifamily.water_heaters.json`. There are four templates for water heaters. In the embedded `openstudio-standards-0.2.11` the water heater template has key `energy_factor_volume_derate` with value `""` which is problematic because it is a string when the class of object should be numeric/float.

`"template": "ZE AEDG Multifamily", "fuel_type": "NaturalGas", "minimum_capacity": 0.0, "maximum_capacity": 74999.99, "start_date": "1919-09-09T00:00:00+00:00", "end_date": "2999-09-09T00:00:00+00:00", "energy_factor_base": 0.67, "energy_factor_volume_derate": "", "standby_loss_base": null, "standby_loss_capacity_allowance": null, "standby_loss_volume_allowance": null, "hourly_loss_base": null, "hourly_loss_volume_allowance": null, "thermal_efficiency": null, "notes": "Code of Federal Regulations 10 CFR Part 430."`

when in standard `'90.1-2013'` water heater templates look like:

`"template": "90.1-2013", "fuel_type": "NaturalGas", "minimum_capacity": 0.0, "maximum_capacity": 74999.99, "start_date": "1919-09-09T00:00:00+00:00", "end_date": "2999-09-09T00:00:00+00:00", "energy_factor_base": 0.67, "energy_factor_volume_derate": 0.0019, "standby_loss_base": null, "standby_loss_capacity_allowance": null, "standby_loss_volume_allowance": null, "hourly_loss_base": null, "hourly_loss_volume_allowance": null, "thermal_efficiency": null, "notes": "From 90.1-2013 Table 7.8"`

`openstudio-standards-0.2.13` has fixed this bug. The embedded v0.2.11 can be overridden by downloading the gem `gem install openstudio-standards -v 0.2.13`.

## Standards Bug Workaround
I put the gem `openstudio-standards-0.2.13` in the my C: drive. I then run on the CLI: `openstudio --verbose --include c/Ruby25-x64/lib/ruby/gems/2.5.0/gems/openstudio-standards-0.2.13/lib` and test it true with: `-e "require 'openstudio-standards'" -e "puts OpenstudioStandards::VERSION"` Even including this custom gem seems not to fix the problem. Solution: change the standard or get rid of gas-fired hot water heaters.

### workflow sub-cases
`workflow_dhw_gas.osw` has gas-fired 50-gallon water heaters in-unit. Has `"Minisplit Heat Pumps with ERVs"` argument to `"zero_energy_multifamily"`. Has "EnableIdealAirLoadsForAllZones" skipped true. "Enable...Zones" was authored under older versions and may no longer be functional.
